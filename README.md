# Warefire - 家庭网络安全监控系统

## 项目概述

Warefire是一款基于主动态势感知的家庭网络安全监控系统，旨在将家庭网络视为一个需要持续监控和管理的整体，而非仅仅保护单个设备。系统采用多层次威胁检测机制，结合签名检测、异常行为分析和威胁情报集成，实现全方位的家庭网络安全防护。

## 主要功能

### 核心功能
- **流量镜像与分析**：捕获和分析所有网络流量，不影响正常上网速度
- **签名检测**：基于已知恶意软件、漏洞利用和僵尸网络特征库的威胁检测
- **异常行为分析**：学习设备正常网络行为，检测异常行为并生成告警
- **威胁情报集成**：实时接入云端威胁情报服务，获取最新恶意IP、域名和URL列表
- **设备管理**：自动发现和识别网络设备，建立设备画像
- **统一管理平台**：提供Web和移动App管理界面

### 安全防护功能
- **智能设备（IoT）专项防护**：微隔离、默认拒绝策略、漏洞预警
- **家长控制与内容过滤**：精细化上网时间管理、分级内容过滤、安全搜索强制
- **隐私保护**：DNS加密、数据出境监控
- **入侵检测与响应**：网络入侵检测、自动化响应

## 系统架构

```
+---------------------+     +---------------------+     +---------------------+
|                     |     |                     |     |                     |
|   家庭网络设备      |     |   核心中枢硬件      |     |   云端服务          |
|                     |     |                     |     |                     |
+---------------------+     +---------------------+     +---------------------+
         |                            |                            |
         | 流量镜像/管理策略           | 威胁情报更新/沙箱分析        |
         |<-------------------------->|--------------------------->|
         |                            |                            |
         | 设备发现/行为数据          | 安全分析/警报生成           |
         |--------------------------->|--------------------------->|
         |                            |                            |
         | 隔离/限速/封锁             | 策略执行                   |
         |<-------------------------->|                            |
         |                            |                            |
         |                            | 管理界面/告警推送           |
         |                            |<--------------------------->|
         |                            |                            |
         |                            |          统一管理平台       |
         |                            |                            |
         |                            |  +---------------------+   |
         |                            |  |  Web管理界面       |   |
         |                            |  +---------------------+   |
         |                            |  |  移动App            |   |
         |                            |  +---------------------+   |
         |                            |                            |
```

## 技术栈

| 模块 | 技术选型 | 说明 |
|------|----------|------|
| 核心中枢硬件 | ARM Cortex-A72 四核处理器 | 如树莓派4B或类似硬件 |
| 操作系统 | 基于Linux的定制固件 | 如OpenWrt或Raspbian |
| 流量分析 | Netfilter/iptables, Scapy | 流量捕获和解析 |
| 安全分析引擎 | Python 3.8+ | 核心分析逻辑 |
| 签名检测 | Suricata | 开源入侵检测系统 |
| 异常行为分析 | Scikit-learn | 机器学习模型 |
| 威胁情报集成 | MISP/OTX | 威胁情报平台集成 |
| 统一管理平台 | React + Node.js | Web前端和API服务 |
| 移动App | Flutter | 跨平台移动应用 |
| 设备管理 | ARP扫描 + nmap | 设备发现和识别 |
| 数据库 | SQLite + Redis | 本地数据存储和缓存 |

## 安装步骤

### 硬件准备
1. 准备一台运行Linux的设备（推荐树莓派4B或类似硬件）
2. 确保设备具有至少2个千兆以太网端口（WAN/LAN）
3. 准备至少4GB RAM和32GB存储

### 软件安装

#### 1. 克隆仓库
```bash
git clone https://github.com/warefire/warefire.git
cd warefire
```

#### 2. 安装依赖
```bash
pip install -r requirements.txt
```

#### 3. 配置系统
```bash
# 复制示例配置文件（如果需要）
cp config.example.yml config.yml
# 编辑配置文件
nano config.yml
```

#### 4. 启动系统
```bash
python -m src.core.main
```

## 快速开始

### 初始设置
1. 启动系统后，系统会进入1-2周的"学习模式"，学习每个设备的正常网络行为
2. 系统默认启用所有核心功能
3. 访问Web管理界面（默认地址：http://localhost:8080）进行初始配置

### 基本使用
1. **查看设备列表**：在Web管理界面的"设备管理"页面查看所有已发现的设备
2. **查看告警**：在"告警中心"页面查看系统生成的安全告警
3. **调整策略**：在"安全策略"页面配置设备分组和访问控制规则
4. **查看报表**：在"报表中心"页面查看系统安全状态和趋势

## 配置说明

### 配置文件结构

```yaml
# 系统配置
system:
  mode: learning  # learning: 学习模式, detection: 检测模式
  learning_period_days: 14  # 学习期天数
  log_level: INFO
  log_path: "data/logs/system.log"

# 流量分析配置
traffic_analyzer:
  enabled: true
  interfaces: ["eth0", "wlan0"]
  capture_filter: ""  # BPF过滤规则
  max_packet_size: 1518
  buffer_size: 104857600  # 100MB

# 更多配置项请参考src/core/config.py
```

### 主要配置项
- **system.mode**：系统运行模式，学习模式下不生成告警，仅建立行为基线
- **system.learning_period_days**：设备行为基线学习期，建议设置为14天
- **traffic_analyzer.interfaces**：需要监控的网络接口
- **signature_detection.rule_sources**：签名规则库源地址
- **threat_intelligence.sources**：威胁情报源配置

## 使用指南

### 设备管理
- **设备分组**：将设备分组管理，便于应用统一安全策略
- **设备隔离**：可将可疑设备隔离至"沙箱网络"，限制其危害
- **设备画像**：查看设备的详细信息和行为基线

### 安全策略
- **基于设备的策略**：为单个设备配置访问控制规则
- **基于分组的策略**：为设备组配置统一的安全策略
- **家长控制**：配置设备的上网时间段和内容过滤规则

### 告警管理
- **告警分级**：告警分为info、warning、high、critical四个级别
- **告警通知**：支持Web和移动App推送通知
- **告警处理**：可确认、解决和关闭告警
- **告警历史**：查看历史告警记录和统计

## 开发指南

### 项目结构

```
warefire/
├── docs/                    # 文档目录
├── src/                     # 源代码目录
│   ├── core/                # 核心分析引擎
│   ├── web/                 # Web管理平台
│   ├── mobile/              # 移动App (Flutter)
│   ├── firmware/            # 固件相关代码
│   └── scripts/             # 辅助脚本
├── tests/                   # 测试目录
├── data/                    # 数据目录
├── requirements.txt         # Python依赖
├── README.md                # 项目说明
└── LICENSE                  # 许可证
```

### 核心模块

#### 1. 流量分析模块 (traffic_analyzer.py)
- 负责捕获和解析网络流量
- 提取流量特征和元数据
- 支持多种协议解析

#### 2. 签名检测模块 (signature_detection.py)
- 基于Suricata规则的威胁检测
- 支持规则库自动更新
- 高效匹配算法

#### 3. 异常行为分析模块 (anomaly_detection.py)
- 设备行为基线学习
- 异常检测算法
- 机器学习模型管理

#### 4. 威胁情报集成 (threat_intelligence.py)
- 连接外部威胁情报平台
- 本地威胁情报缓存
- 情报更新机制

#### 5. 设备管理模块 (device_manager.py)
- 设备发现和识别
- 设备画像管理
- 设备分组和策略

#### 6. 告警引擎 (alert_engine.py)
- 告警生成和分级
- 告警通知机制
- 告警历史管理

### 开发流程
1. 首先实现核心分析引擎的基础功能
2. 开发Web管理平台的API服务
3. 实现Web前端界面
4. 开发移动App
5. 集成和测试

### 测试

```bash
# 运行单元测试
pytest tests/unit_tests/

# 运行集成测试
pytest tests/integration_tests/

# 运行系统测试
python test_system.py
```

## 贡献信息

### 如何贡献
1. Fork本仓库
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开Pull Request

### 代码规范
- 使用Black进行代码格式化
- 使用Flake8进行代码检查
- 遵循PEP 8编码规范
- 为新功能添加测试

## 许可证

本项目采用GPL-3.0许可证 - 详情请查看LICENSE文件

## 联系方式

- 项目主页：https://github.com/warefire/warefire
- 问题反馈：https://github.com/warefire/warefire/issues
- 邮件：contact@warefire.com

## 致谢

- 感谢所有为项目做出贡献的开发者
- 感谢开源社区提供的优秀工具和库
- 感谢用户的反馈和支持

## 版本历史

### 1.0.0 (2025-12-14)
- 初始版本发布
- 实现核心安全分析引擎
- 支持设备管理和流量分析
- 集成签名检测和异常行为分析
- 实现威胁情报集成
- 提供Web管理界面API

---

**Warefire - 让家庭网络更安全** 🛡️
